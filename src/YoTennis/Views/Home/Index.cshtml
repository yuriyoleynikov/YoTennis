@model ContainerForMatchModel
@using YoTennis.Helpers;

@{
    ViewData["Title"] = "Home Page";
}

<div class="game-commands">
    <div>
        <table class="table">
            <thead>
                <tr>
                    <th>
                        Players
                        @if (Model.Sort != Sort.PlayerNameDescending)
                        {
                            @Html.ActionLink("↓", "Index", "Home", new
                       {
                           count = Model.Count,
                           skip = Model.Skip,
                           player = Model.SelectedPlayers,
                           state = Model.SelectedState,
                           beginningWithDate = Model.BeginningWithDate,
                           finishingBeforeDate = Model.FinishingBeforeDate,
                           sort = Sort.PlayerNameDescending
                       })
                        }
                        else
                        {
                            <b>↓</b>
                        }

                        @if (Model.Sort != Sort.PlayerNameAscending)
                        {
                            @Html.ActionLink("↑", "Index", "Home", new
                       {
                           count = Model.Count,
                           skip = Model.Skip,
                           player = Model.SelectedPlayers,
                           state = Model.SelectedState,
                           beginningWithDate = Model.BeginningWithDate,
                           finishingBeforeDate = Model.FinishingBeforeDate,
                           sort = Sort.PlayerNameAscending
                       })
                        }
                        else
                        {
                            <b>↑</b>
                        }
                    </th>
                    <th>
                        Date @if (Model.Sort != Sort.DateDescending)
                        {
                            @Html.ActionLink("↓", "Index", "Home", new
                       {
                           count = Model.Count,
                           skip = Model.Skip,
                           player = Model.SelectedPlayers,
                           state = Model.SelectedState,
                           beginningWithDate = Model.BeginningWithDate,
                           finishingBeforeDate = Model.FinishingBeforeDate,
                           sort = Sort.DateDescending
                       })
                        }
                        else
                        {
                            <b>↓</b>
                        }

                        @if (Model.Sort != Sort.DateAscending)
                        {
                            @Html.ActionLink("↑", "Index", "Home", new
                       {
                           count = Model.Count,
                           skip = Model.Skip,
                           player = Model.SelectedPlayers,
                           state = Model.SelectedState,
                           beginningWithDate = Model.BeginningWithDate,
                           finishingBeforeDate = Model.FinishingBeforeDate,
                           sort = Sort.DateAscending
                       })
                        }
                        else
                        {
                            <b>↑</b>
                        }
                    </th>
                    <th>
                        State @if (Model.Sort != Sort.StateDescending)
                        {
                            @Html.ActionLink("↓", "Index", "Home", new
                       {
                           count = Model.Count,
                           skip = Model.Skip,
                           player = Model.SelectedPlayers,
                           state = Model.SelectedState,
                           beginningWithDate = Model.BeginningWithDate,
                           finishingBeforeDate = Model.FinishingBeforeDate,
                           sort = Sort.StateDescending
                       })
                        }
                        else
                        {
                            <b>↓</b>
                        }

                        @if (Model.Sort != Sort.StateAscending)
                        {
                            @Html.ActionLink("↑", "Index", "Home", new
                       {
                           count = Model.Count,
                           skip = Model.Skip,
                           player = Model.SelectedPlayers,
                           state = Model.SelectedState,
                           beginningWithDate = Model.BeginningWithDate,
                           finishingBeforeDate = Model.FinishingBeforeDate,
                           sort = Sort.StateAscending
                       })
                        }
                        else
                        {
                            <b>↑</b>
                        }
                    </th>
                    <th>
                        Score
                    </th>
                </tr>
            </thead>

            <tbody>
                @foreach (var match in Model.ListMatchModelView)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelMatch => match.Players)
                        </td>
                        <td>
                            @Html.DisplayFor(modelMatch => match.Date)
                        </td>
                        <td>
                            @Html.DisplayFor(modelMatch => match.Status)
                        </td>
                        <td>
                            @Html.DisplayFor(modelMatch => match.Score)
                        </td>
                        <td>
                            @Html.ActionLink("Edit", "Index", "Match", new { id = match.Id }) |
                            @Html.ActionLink("Details", "Details", "Match", new { id = match.Id }) |
                            @Html.ActionLink("Stats", "Stats", "Match", new { id = match.Id }) |
                            @Html.ActionLink("Delete", "Delete", "Home", new
                       {
                           id = match.Id,
                           returnUrl = Url.Action("Index", "Home",
                           new
                           {
                               count = Model.Count,
                               skip = Model.Skip,
                               player = Model.SelectedPlayers,
                               state = Model.SelectedState,
                               beginningWithDate = Model.BeginningWithDate,
                               finishingBeforeDate = Model.FinishingBeforeDate,
                               sort = Model.Sort
                           })
                       })
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="my-margin-left">
        <p>Filter</p>

        @if (Model.SelectedPlayers.Any() || Model.SelectedState.Any() ||
                                    Model.BeginningWithDate != null || Model.FinishingBeforeDate != null)
        {
            <p>@Html.ActionLink("Clear", "Index", "Home", new { count = Model.Count, skip = 0 })</p>
        }

        <p>Players:</p>
        <ul>
            @foreach (var player in Model.FilterPayers)
            {
                if (!Model.SelectedPlayers.Any() && !Model.SelectedState.Any())
                {
                    <li>
                        @Html.ActionLink(player, "Index", "Home", new
                   {
                       count = Model.Count,
                       skip = 0,
                       player = Model.SelectedPlayers.WithElement(player),
                       beginningWithDate = Model.BeginningWithDate,
                       finishingBeforeDate = Model.FinishingBeforeDate,
                       sort = Model.Sort
                   })
                    </li>
                }
                else
                {
                    if (Model.SelectedPlayers.Contains(player))
                    {
                        <li>
                            @player (@Html.ActionLink("Remove", "Index", "Home", new
                                {
                                    count = Model.Count,
                                    skip = 0,
                                    player = Model.SelectedPlayers.WithoutElement(player),
                                    state = Model.SelectedState,
                                    beginningWithDate = Model.BeginningWithDate,
                                    finishingBeforeDate = Model.FinishingBeforeDate,
                                    sort = Model.Sort
                                }))
                        </li>
                    }
                    else
                    {
                        <li>
                            @Html.ActionLink(player, "Index", "Home", new
                       {
                           count = Model.Count,
                           skip = 0,
                           player = player,
                           beginningWithDate = Model.BeginningWithDate,
                           finishingBeforeDate = Model.FinishingBeforeDate,
                           sort = Model.Sort
                       })
                            (@Html.ActionLink("Add", "Index", "Home", new
                        {
                            count = Model.Count,
                            skip = 0,
                            player = Model.SelectedPlayers.WithElement(player),
                            state = Model.SelectedState,
                            beginningWithDate = Model.BeginningWithDate,
                            finishingBeforeDate = Model.FinishingBeforeDate,
                            sort = Model.Sort
                        }))
                        </li>
                    }
                }
            }
        </ul>
        <p>Current Status:</p>
        <ul>
            @foreach (var state in Model.FilterState)
            {
                if (!Model.SelectedPlayers.Any() && !Model.SelectedState.Any())
                {
                    <li>
                        @Html.ActionLink(state.ToString(), "Index", "Home",
                            new
                            {
                                count = Model.Count,
                                skip = 0,
                                player = Model.SelectedPlayers,
                                state = Model.SelectedState.WithElement(state),
                                beginningWithDate = Model.BeginningWithDate,
                                finishingBeforeDate = Model.FinishingBeforeDate,
                                sort = Model.Sort
                            })
                    </li>
                }
                else
                {
                    if (Model.SelectedState.Contains(state))
                    {
                        <li>
                            @state.ToString()
                            (@Html.ActionLink("Remove", "Index", "Home",
                           new
                           {
                               count = Model.Count,
                               skip = 0,
                               player = Model.SelectedPlayers,
                               beginningWithDate = Model.BeginningWithDate,
                               finishingBeforeDate = Model.FinishingBeforeDate,
                               sort = Model.Sort
                           }))
                        </li>
                    }
                    else
                    {
                        if (Model.SelectedPlayers.Any())
                        {
                            <li>
                                @Html.ActionLink(state.ToString(), "Index", "Home",
                            new
                            {
                                count = Model.Count,
                                skip = 0,
                                state = state,
                                beginningWithDate = Model.BeginningWithDate,
                                finishingBeforeDate = Model.FinishingBeforeDate,
                                sort = Model.Sort
                            })
                                (@Html.ActionLink("Add", "Index", "Home",
                                new
                                {
                                    count = Model.Count,
                                    skip = 0,
                                    player = Model.SelectedPlayers,
                                    state = state,
                                    beginningWithDate = Model.BeginningWithDate,
                                    finishingBeforeDate = Model.FinishingBeforeDate,
                                    sort = Model.Sort
                                }))
                            </li>
                        }
                        else
                        {
                            <li>
                                @Html.ActionLink(state.ToString(), "Index", "Home",
                                new
                                {
                                    count = Model.Count,
                                    skip = 0,
                                    player = Model.SelectedPlayers,
                                    state = state,
                                    beginningWithDate = Model.BeginningWithDate,
                                    finishingBeforeDate = Model.FinishingBeforeDate,
                                    sort = Model.Sort
                                })
                            </li>
                        }
                    }
                }
            }
        </ul>

        <p>Beginning with date:</p>
        @if (@Model.BeginningWithDate == null)
        {
            <form method="get">

                @if (Model.Count != 10)
                {
                    <input name="count" value="@Model.Count" type="hidden" />
                }

                @if (Model.Skip != 0)
                {
                    <input name="skip" value="@Model.Skip" type="hidden" />
                }

                @if (Model.SelectedPlayers.Any())
                {
                    <input name="player" value="@Model.SelectedPlayers" type="hidden" />
                }

                @if (Model.SelectedState.Any())
                {
                    <input name="state" value="@Model.SelectedState" type="hidden" />
                }

                @if (Model.FinishingBeforeDate != null)
                {
                    <input name="finishingBeforeDate" value="@Model.FinishingBeforeDate" type="hidden" />
                }

                @if (Model.Sort != Sort.None)
                {
                    <input name="sort" value="@Model.Sort" type="hidden" />
                }

                <input asp-for="@Model.BeginningWithDate" class="form-control" />
                
                <button type="submit" class="btn btn-default">Only this</button>                

                <button type="submit" class="btn btn-default">Add</button>

            </form>
        }
        else
        {
            <div>
                @Model.BeginningWithDate.Value.ToString("D")
                (
                @Html.ActionLink("Remove", "Index", "Home",
                                new
                                {
                                    count = Model.Count,
                                    skip = 0,
                                    player = Model.SelectedPlayers,
                                    state = Model.SelectedState,
                                    finishingBeforeDate = Model.FinishingBeforeDate,
                                    sort = Model.Sort
                                })
                )
            </div>

        }
        <p>Finishing before date:</p>
        @if (@Model.FinishingBeforeDate == null)
        {
            <form method="get">

                @if (Model.Count != 10)
                {
                    <input name="count" value="@Model.Count" type="hidden" />
                }

                @if (Model.Skip != 0)
                {
                    <input name="skip" value="@Model.Skip" type="hidden" />
                }

                @if (Model.SelectedPlayers.Any())
                {
                    <input name="player" value="@Model.SelectedPlayers" type="hidden" />
                }

                @if (Model.SelectedState.Any())
                {
                    <input name="state" value="@Model.SelectedState" type="hidden" />
                }

                @if (Model.BeginningWithDate != null)
                {
                    <input name="beginningWithDate" value="@Model.BeginningWithDate" type="hidden" />
                }

                @if (Model.Sort != Sort.None)
                {
                    <input name="sort" value="@Model.Sort" type="hidden" />
                }

                <input asp-for="@Model.FinishingBeforeDate" class="form-control" />

                <button type="submit" class="btn btn-default">Only this</button>

                <button type="submit" class="btn btn-default">Add</button>
            </form>
        }
        else
        {
            <div>
                @Model.FinishingBeforeDate.Value.ToString("D")
                (
                @Html.ActionLink("Remove", "Index", "Home",
                                new
                                {
                                    count = Model.Count,
                                    skip = 0,
                                    player = Model.SelectedPlayers,
                                    state = Model.SelectedState,
                                    beginningWithDate = Model.BeginningWithDate,
                                    sort = Model.Sort
                                })
                )
            </div>

        }
    </div>

</div>
<div>
    <p>
        Show -
        @Html.ActionLink("10", "Index", "Home", new
   {
       count = 10,
       skip = 0,
       player = Model.SelectedPlayers,
       state = Model.SelectedState,
       beginningWithDate = Model.BeginningWithDate,
       finishingBeforeDate = Model.FinishingBeforeDate,
       sort = Model.Sort
   }) |
        @Html.ActionLink("20", "Index", "Home", new
   {
       count = 20,
       skip = 0,
       player = Model.SelectedPlayers,
       state = Model.SelectedState,
       beginningWithDate = Model.BeginningWithDate,
       finishingBeforeDate = Model.FinishingBeforeDate,
       sort = Model.Sort
   }) |
        @Html.ActionLink("All", "Index", "Home", new
   {
       count = Model.TotalCount != 0 ? Model.TotalCount : 10,
       skip = 0,
       player = Model.SelectedPlayers,
       state = Model.SelectedState,
       beginningWithDate = Model.BeginningWithDate,
       finishingBeforeDate = Model.FinishingBeforeDate,
       sort = Model.Sort
   })
    </p>

    @if (Model.Count != Model.TotalCount)
    {
        <p>
            Page
            @if (Model.Skip != 0)
                {
                @Html.ActionLink("<", "Index", "Home", new
           {
               count = Model.Count,
               skip = Model.Skip - Model.Count,
               player = Model.SelectedPlayers,
               state = Model.SelectedState,
               beginningWithDate = Model.BeginningWithDate,
               finishingBeforeDate = Model.FinishingBeforeDate,
               sort = Model.Sort
           })
            }
            @{
                int currentPage = Model.Skip == 0 ? 1 : Model.Skip / Model.Count + 1;
            }
            @currentPage
            @if (Model.Skip + Model.Count < Model.TotalCount)
                {
                @Html.ActionLink(">", "Index", "Home", new
           {
               count = Model.Count,
               skip = Model.Skip + Model.Count,
               player = Model.SelectedPlayers,
               state = Model.SelectedState,
               beginningWithDate = Model.BeginningWithDate,
               finishingBeforeDate = Model.FinishingBeforeDate,
               sort = Model.Sort
           })
            }
        </p>
                }
    <p>@Model.TotalCount Matches in system</p>
</div>
